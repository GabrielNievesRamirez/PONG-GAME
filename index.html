<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PONG</title>
    <style>
        /* Estilos CSS omitidos para brevedad */
    </style>
</head>
<body>

<div class="escenario">
    <div class="marcador marcador1">0</div>
    <div class="marcador marcador2">0</div>

    <div class="pala pala1"></div>
    <div class="pala pala2"></div>

    <div class="red"></div>
    <div class="pelota"></div>
</div>

<script>
    // OBJETOS:
    class Bordes {
        constructor(minX, maxX, minY, maxY) {
            this.minX = minX;
            this.maxX = maxX;
            this.minY = minY;
            this.maxY = maxY;
        }
    }

    class ObjetoMovil {
        constructor(bordesTablero, elem, vel) {
            this.bordesTablero = bordesTablero;
            this.vel = vel;
            this.x = parseInt(getComputedStyle(elem).left);
            this.y = parseInt(getComputedStyle(elem).bottom);
            this.ancho = parseInt(getComputedStyle(elem).width);
            this.alto = parseInt(getComputedStyle(elem).height);
            this.elem = elem;
        }

        GetBordes() {
            return new Bordes(this.x - this.ancho / 2, this.x + this.ancho / 2, this.y - this.alto / 2, this.y + this.alto / 2);
        }

        Resetear() {
            this.ancho = parseInt(getComputedStyle(this.elem).width);
            this.alto = parseInt(getComputedStyle(this.elem).height);
        }
    }

    class Pelota extends ObjetoMovil {
        constructor(bordesTablero, elem, vel, dirX, dirY, arrastre) {
            super(bordesTablero, elem, vel);
            this.dirX = dirX;
            this.dirY = dirY;
            this.arrastre = arrastre;
        }

        Mover() {
            this.x += this.dirX * this.vel * deltaTime;
            this.y += this.dirY * this.vel * deltaTime;
            this.elem.style.left = this.x + "px";
            this.elem.style.bottom = this.y + "px";
            this.ComprobarRebote();
        }

        ComprobarRebote() {
            if (this.y + this.alto / 2 > this.bordesTablero.maxY && this.dirY > 0) {
                this.RebotarY();
            } else if (this.y - this.alto / 2 < this.bordesTablero.minY && this.dirY < 0) {
                this.RebotarY();
            }
        }

        RebotarX(inerciaY) {
            this.dirX = -this.dirX;
            this.dirY += inerciaY * this.arrastre;
        }

        RebotarY() {
            this.dirY = -this.dirY;
        }

        ComprobarGol() {
            if (this.x - this.ancho / 2 < this.bordesTablero.minX) {
                return 2;
            } else if (this.x + this.ancho / 2 > this.bordesTablero.maxX) {
                return 1;
            }
            return 0;
        }

        Resetear(vel, x, y, dirX, dirY) {
            this.vel = vel;
            this.x = x;
            this.y = y;
            this.dirX = dirX;
            this.dirY = dirY;
            super.Resetear();
        }

    }

    class Pala extends ObjetoMovil {
        constructor(bordesTablero, elem, vel, rozamiento, keyCodeArriba, keyCodeAbajo) {
            super(bordesTablero, elem, vel);

            this.moviendose = false;
            this.velActual = 0;
            this.rozamiento = rozamiento;
            this.keyCodeArriba = keyCodeArriba;
            this.keyCodeAbajo = keyCodeAbajo;
            document.addEventListener("keydown", this.IniciarMovimiento.bind(this));
            document.addEventListener("keyup", this.FinalizarMovimiento.bind(this));
        }

        IniciarMovimiento(evento) {
            this.moviendose = true;
            if (evento.key == this.keyCodeArriba) {
                this.velActual = this.vel;
            } else if (evento.key == this.keyCodeAbajo) {
                this.velActual = -this.vel;
            }
        }

        FinalizarMovimiento(evento) {
            if (evento.key == this.keyCodeAbajo || evento.key == this.keyCodeArriba) {
                this.moviendose = false;
                this.Frenar(); // Asegurarse de frenar cuando se suelta la tecla
            }
        }

        Mover() {
            this.y += this.velActual * deltaTime;
            if (this.y + this.alto / 2 > this.bordesTablero.maxY) this.y = this.bordesTablero.maxY - this.alto / 2;
            if (this.y - this.alto / 2 < this.bordesTablero.minY) this.y = this.alto / 2;
            this.elem.style.bottom = this.y + "px";
        }

        Frenar() {
            if (!this.moviendose) {
                this.velActual /= this.rozamiento;
                if (Math.abs(this.velActual) < 0.1) this.velActual = 0;
            }
        }

        ComprobarColision(bordes2) {
            var bordes1 = this.GetBordes();
            return !(
                bordes1.maxX < bordes2.minX ||
                bordes1.minX > bordes2.maxX ||
                bordes1.maxY < bordes2.minY ||
                bordes1.minY > bordes2.maxY
            );
        }

        Pause() {
            this.velActual = 0; // Detener el movimiento
        }

        Resume() {
            // Reanudar el movimiento según la última dirección
            if (this.moviendose) {
                if (this.velActual > 0) {
                    this.velActual = this.vel;
                } else if (this.velActual < 0) {
                    this.velActual = -this.vel;
                }
            }
        }
    }

    class Marcador {
        constructor(elem) {
            this.elem = elem;
            this.puntos = 0;
        }

        GanarPunto() {
            this.puntos++;
            this.elem.innerHTML = "" + this.puntos;
        }
    }

    // JUEGO
    var escenarioElem = document.querySelector(".escenario");
    var estilos = ["tecno", "florido", "neon", "loco"];
    var bordesTablero = new Bordes(0, 800, 0, 600);
    var dir = Math.random() * 2 * Math.PI;
    var pelota = new Pelota(bordesTablero, document.querySelector(".pelota"), 300, Math.cos(dir), Math.sin(dir), 0.1);
    var pala1 = new Pala(bordesTablero, document.querySelector(".pala1"), 300, 1.15, "a", "z");
    var pala2 = new Pala(bordesTablero, document.querySelector(".pala2"), 300, 1.15, "ArrowUp", "ArrowDown");
    var marcador1 = new Marcador(document.querySelector(".marcador1"));
    var marcador2 = new Marcador(document.querySelector(".marcador2"));

    function Update() {
        pelota.Mover();
        MoverPalas();
        ComprobarPalazo();
        ComprobarGol();
    }

    function MoverPalas() {
        pala1.Frenar();
        pala2.Frenar();
        pala1.Mover();
        pala2.Mover();
    }

    function ComprobarPalazo() {
        if (pala1.ComprobarColision(pelota.GetBordes())) {
            if (pelota.dirX < 0) pelota.RebotarX(pala1.velActual * deltaTime);
        } else if (pala2.ComprobarColision(pelota.GetBordes())) {
            if (pelota.dirX > 0) pelota.RebotarX(pala2.velActual * deltaTime);
        }
    }

    function ComprobarGol() {
        var ganador = pelota.ComprobarGol();
        if (ganador != 0) {
            if (ganador == 1) marcador1.GanarPunto();
            else marcador2.GanarPunto();
            pelota.Resetear(300, 400, 300, Math.cos(Math.random() * 2 * Math.PI), Math.sin(Math.random() * 2 * Math.PI));
            pala1.Resetear(300, 50, 300, 1, 0);
            pala2.Resetear(300, 750, 300, -1, 0);
        }
    }

    var lastTime = performance.now();
    var deltaTime = 0;

    function Loop() {
        var now = performance.now();
        deltaTime = (now - lastTime) / 1000; // deltaTime en segundos
        lastTime = now;

        if (!paused) {
            Update();
        }

        requestAnimationFrame(Loop);
    }

    // Iniciar juego
    var paused = false; // Variable para controlar el estado de pausa
    Loop();

    // Event listener para la tecla Espacio (para pausar/reanudar el juego)
    document.addEventListener("keydown", function(event) {
        if (event.key === " ") { // Espacio para pausar/reanudar
            paused = !paused;
            if (paused) {
                pala1.Pause();
                pala2.Pause();
            } else {
                pala1.Resume();
                pala2.Resume();
            }
        }
    });

</script>

</body>
</html>

